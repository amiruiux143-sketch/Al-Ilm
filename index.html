<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AL-ILM PRO PLATFORM</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #000000;
            --surface: #121212;
            --accent: #d4af37;
            --text: #ffffff;
            --text-secondary: #999;
            --border: rgba(255,255,255,0.08);
            --safe-top: env(safe-area-inset-top);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }

        .main-viewport { height: 100vh; overflow-y: auto; padding: calc(var(--safe-top) + 20px) 20px 180px; scroll-behavior: smooth; }

        .app-header { margin-bottom: 25px; }
        .app-header h1 { font-size: 34px; font-weight: 800; letter-spacing: -1px; }

        .content-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        
        /* СТИЛИ КАРТОЧЕК С ПОДДЕРЖКОЙ ФОНА */
        .card-lg, .card-sm { 
            position: relative; 
            overflow: hidden; 
            background: var(--surface); 
            border-radius: 24px; 
            border: 1px solid var(--border); 
            transition: 0.2s; 
        }
        .card-lg { grid-column: span 2; padding: 25px; }
        .card-sm { padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .card-sm:active, .card-lg:active { transform: scale(0.98); opacity: 0.8; }
        
     /* Прозрачная каллиграфия на фоне */
.quran-bg-text {
    position: absolute;
    right: -10px;
    bottom: -5px;
    font-family: 'Amiri', serif;
    font-size: 45px;
    color: var(--accent);
    opacity: 0.08; /* Регулируй прозрачность здесь */
    white-space: nowrap;
    pointer-events: none;
    user-select: none;
    z-index: 1;
}

/* Обязательно добавь это к стилям карточек, чтобы каллиграфия не вылезала за края */
.card-sm, .card-lg {
    position: relative;
    overflow: hidden;
}


        .icon-box { position: relative; z-index: 2; width: 45px; height: 45px; background: var(--bg); border-radius: 14px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; color: var(--accent); font-size: 20px; }
        .card-title { position: relative; z-index: 2; font-size: 18px; font-weight: 700; }
        .card-sub { position: relative; z-index: 2; font-size: 13px; color: var(--text-secondary); }

        .sticky-search { position: sticky; top: -21px; z-index: 100; background: var(--bg); padding: 15px 0; }
        .search-input-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 18px; padding: 14px 20px; display: flex; align-items: center; gap: 12px; }
        .search-input-wrap input { background: none; border: none; color: #fff; flex: 1; outline: none; font-size: 16px; }

        .ayah-card { background: var(--surface); border-radius: 28px; padding: 25px; margin-bottom: 20px; border: 1px solid var(--border); position: relative; }
        .ar-text { font-family: 'Amiri', serif; font-size: 34px; text-align: right; line-height: 2.3; margin-bottom: 20px; direction: rtl; color: #fff; }
        .ru-text { font-size: 16px; line-height: 1.6; color: #ececec; margin-bottom: 15px; }
        
        .tafsir-box { background: rgba(212, 175, 55, 0.05); padding: 15px; border-radius: 18px; border-left: 3px solid var(--accent); margin-top: 15px; font-size: 14px; color: var(--text-secondary); line-height: 1.5; }
        
        .ayah-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border); font-size: 12px; color: var(--accent); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        
        .ayah-actions { display: flex; gap: 15px; }
        .action-btn { width: 35px; height: 35px; background: var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); color: #fff; font-size: 14px; }

        .prayer-list { margin-top: 15px; }
        .prayer-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid var(--border); }

        .tasbih-container { text-align: center; padding: 40px 20px; }
        .tasbih-circle { width: 220px; height: 220px; border: 8px solid var(--surface); border-top-color: var(--accent); border-radius: 50%; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 60px; font-weight: 800; color: var(--accent); cursor: pointer; transition: 0.1s; position: relative; box-shadow: 0 0 30px rgba(212, 175, 55, 0.1); }
        .tasbih-circle:active { transform: scale(0.95); background: rgba(212, 175, 55, 0.05); }
        .tasbih-reset { background: var(--surface); color: var(--text); border: none; padding: 10px 25px; border-radius: 50px; font-size: 14px; margin-bottom: 10px; width: 100%; }

        .nav-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(18,18,18,0.9); backdrop-filter: blur(20px); border: 1px solid var(--border); height: 75px; width: 92%; border-radius: 38px; display: flex; justify-content: space-around; align-items: center; z-index: 1001; }
        .nav-btn { color: #555; display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 18px; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn span { font-size: 9px; font-weight: 800; text-transform: uppercase; }

        .page { display: none; }
        .page.active { display: block; animation: pageFade 0.4s ease forwards; }
        @keyframes pageFade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .lesson-row { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--surface); border-radius: 18px; margin-bottom: 12px; border: 1px solid var(--border); cursor: pointer; }
        .lesson-id { width: 32px; height: 32px; background: var(--accent); color: #000; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; }

        .detail-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; padding: 30px; overflow-y: auto; display: none; }
        .detail-overlay.active { display: block; animation: pageFade 0.3s ease; }
    </style>
</head>
<body>
    
<div id="nameModal" class="detail-overlay"></div>

<div class="main-viewport" id="appScroll">
    
    <section id="p-home" class="page active">
        <div class="app-header">
            <h1>Al-Ilm </h1>
            <p style="color: var(--text-secondary); font-size: 14px;">Путь к истинным знаниям</p>
        </div>
        <div id="last-read-container" style="margin-bottom: 20px;"></div>
        <div class="content-grid">
            <div class="card-lg" onclick="App.nav('quran')">
                <div class="quran-bg-text">القرآن الكريم</div>
                <div class="icon-box"><i class="fa-solid fa-book-quran"></i></div>
                <div style="margin-top:15px; position: relative; z-index: 2;">
                    <div class="card-title">Коран</div>
                    <div class="card-sub">Чтение и тафсир по аятам</div>
                </div>
            </div>

            <div class="card-sm" onclick="App.nav('academy')">
                <div class="icon-box"><i class="fa-solid fa-graduation-cap"></i></div>
                <div><div class="card-title">Академия</div><div class="card-sub">Курсы уроков</div></div>
            </div>
            <div class="card-sm" onclick="App.nav('prayer')">
                <div class="icon-box"><i class="fa-solid fa-clock"></i></div>
                <div><div class="card-title">Намаз</div><div class="card-sub">Время молитв</div></div>
            </div>
            <div class="card-sm" onclick="App.nav('tasbih')">
                <div class="icon-box"><i class="fa-solid fa-toggle-on"></i></div>
                <div><div class="card-title">Тасбих</div><div class="card-sub">Счетчик зикров</div></div>
            </div>
            <div class="card-sm" onclick="App.nav('names')">
                <div class="icon-box"><i class="fa-solid fa-star"></i></div>
                <div><div class="card-title">Имена</div><div class="card-sub">99 Имен Аллаха</div></div>
            </div>
        </div>
    </section>

    <section id="p-quran" class="page">
        <div class="sticky-search"><div class="search-input-wrap"><i class="fa-solid fa-magnifying-glass" style="color:#555"></i><input type="text" placeholder="Найти суру..." oninput="App.search(this.value)"></div></div>
        <div id="surahList" class="content-grid"></div>
    </section>

    <section id="p-reader" class="page"><div id="readerHeader"></div><div id="readerView"></div></section>
    <section id="p-prayer" class="page"><h1>Время молитв</h1><div class="card-lg" id="prayer-display"><p style="text-align: center;">Разрешите доступ к геопозиции...</p></div></section>
    <section id="p-academy" class="page"><h1></h1><div id="academy-list"></div></section>
    <section id="p-lessons" class="page"><div id="lessons-view"></div></section>
    <section id="p-tasbih" class="page">
        <h1>Тасбих</h1>
        <div class="card-lg">
            <div class="tasbih-container">
                <div class="tasbih-circle" onclick="App.countTasbih()" id="tasbih-num">0</div>
                <button class="tasbih-reset" onclick="App.resetTasbih()">Сбросить</button>
            </div>
        </div>
    </section>
    <section id="p-names" class="page"><h1></h1><div id="names-list"></div></section>
</div>

<div class="nav-bar">
    <div class="nav-btn active" onclick="App.nav('home')"><i class="fa-solid fa-house"></i><span>Главная</span></div>
    <div class="nav-btn" onclick="App.nav('quran')"><i class="fa-solid fa-book-open"></i><span>Коран</span></div>
    <div class="nav-btn" onclick="App.nav('prayer')"><i class="fa-solid fa-clock"></i><span>Намаз</span></div>
    <div class="nav-btn" onclick="App.nav('academy')"><i class="fa-solid fa-graduation-cap"></i><span>Уроки</span></div>
</div>

<script>
// ВЕСЬ JS КОД ОСТАЛСЯ ТАКИМ ЖЕ, КАК В ТВОЕМ ФАЙЛЕ
const App = {
    surahs: [],
    audio: new Audio(),
    currentPlayingId: null,
    bookmark: JSON.parse(localStorage.getItem('ilm_last_bookmark')) || null,
    tasbihCount: parseInt(localStorage.getItem('tasbih_val')) || 0,

    courses: [
        { name: "Муаллим Сани", sub: "Обучение алфавиту", icon: "fa-book", url: "https://youtube.com/playlist?list=PLVB45iS0wu6CYc85RLpDoKqb7pSIYAkvt&si=Vy8bSwMF47Xr-nZN" },
        { name: "Единобожие", sub: "Единобожие", icon: "fa-sun", url: "https://youtube.com/playlist?list=PLj4CrihtzTY7W57413lV7OVFwAo4NSaCo&si=itrblw_IVE0yCpq0" },
        { name: "Фикх (Омовение)", sub: "Правила чистоты", icon: "fa-droplet", url: "https://youtube.com/playlist?list=PLH3UnLxU7hlR4s4ndmBDEgM5kLUffi-ne&si=nDgnVJAaZrxoVNwL" }
    ],

    // ТУТ 99 ИМЕН (СОХРАНЕНЫ ПОЛНОСТЬЮ)
    all99Names: [
        {ar: "الله", ru: "Аллах", tr: "Единый Бог", desc: "Собственное имя Господа миров, указывающее на Его Божественную сущность. Оно включает в себя все остальные имена. Тот, Кому поклоняются по праву."},
        {ar: "الرحمن", ru: "Ар-Рахман", tr: "Милостивый", desc: "Обладатель безграничной милости, которая охватывает всё сущее. Он дарует блага всем созданиям в этом мире."},
        {ar: "الرحيم", ru: "Ар-Рахим", tr: "Милосердный", desc: "Проявляющий особую милость к Своим верующим рабам. Тот, Кто ведет к вечному спасению в Раю."},
        {ar: "الملك", ru: "Аль-Малик", tr: "Царь", desc: "Абсолютный Владыка мироздания. Вся власть принадлежит только Ему, и Он управляет всеми делами."},
        {ar: "القدوس", ru: "Аль-Куддус", tr: "Святой", desc: "Пречистый от любых недостатков. Тот, Кто бесконечно далек от любого несовершенства, присущего творениям."},
        {ar: "السلام", ru: "Ас-Салям", tr: "Миротворящий", desc: "Дарующий мир и безопасность. Тот, Кто свободен от всякого зла, и от Кого исходит только благо."},
        {ar: "المؤمن", ru: "Аль-Мумин", tr: "Дарующий веру", desc: "Источник стабильности и веры. Тот, Кто дает безопасность тем, кто ищет у Него защиты."},
        {ar: "المهيمن", ru: "Аль-Мухаймин", tr: "Хранитель", desc: "Свидетель всего сущего. Тот, Кто полностью контролирует и оберегает каждое Свое творение."},
        {ar: "العزيز", ru: "Аль-Азиз", tr: "Могущественный", desc: "Непобедимый и Всемогущий. Тот, Чьему величию подчинено абсолютно всё во Вселенной."},
        {ar: "الجبار", ru: "Аль-Джаббар", tr: "Подчиняющий", desc: "Тот, Кто исправляет положение творений и принуждает к тому, что пожелает по Своей мудрости."},
        {ar: "المتكبر", ru: "Аль-Мутакаббир", tr: "Превосходящий", desc: "Обладатель истинного величия. Только Он заслуживает гордости, будучи выше любого описания."},
        {ar: "الخالق", ru: "Аль-Халик", tr: "Творец", desc: "Создающий вещи из небытия. Тот, Кто предопределил судьбу каждой частицы ещё до её появления."},
        {ar: "البارئ", ru: "Аль-Бари", tr: "Создатель", desc: "Тот, Кто воплощает замысел творения в идеальную реальность без каких-либо изъянов."},
        {ar: "المصور", ru: "Аль-Мусаввир", tr: "Придающий форму", desc: "Дарующий каждому творению уникальный облик. Тот, Кто конструирует красоту мироздания."},
        {ar: "الغفار", ru: "Аль-Гаффар", tr: "Прощающий", desc: "Многократно прощающий грехи. Тот, Кто скрывает ошибки рабов и дает им шанс на спасение."},
        {ar: "القهар", ru: "Аль-Каххар", tr: "Господствующий", desc: "Сокрушающий гордецов. Тот, пред Чьим могуществом склоняются все короли и правители."},
        {ar: "الوهاب", ru: "Аль-Ваххаб", tr: "Дарующий", desc: "Тот, Кто дарует блага безвозмездно. Он наделяет Своих рабов сокровищами без просьбы и ожидания отдачи."},
        {ar: "الرزاق", ru: "Ар-Раззак", tr: "Наделяющий", desc: "Тот, Кто обеспечивает пропитанием каждое живое существо — от муравья до человека."},
        {ar: "الفتاح", ru: "Аль-Фаттах", tr: "Раскрывающий", desc: "Открывающий двери милости и успеха. Тот, Кто разрешает любые трудности и судит по справедливости."},
        {ar: "العليم", ru: "Аль-Алим", tr: "Всезнающий", desc: "Тот, Чьи знания бесконечны. Он знает прошлое, настоящее, будущее и даже то, чего никогда не случится."},
        {ar: "القابض", ru: "Аль-Кабид", tr: "Удерживающий", desc: "Тот, Кто по Своей мудрости сужает средства к существованию или забирает души в назначенный час."},
        {ar: "الباسط", ru: "Аль-Басит", tr: "Простирающий", desc: "Дарующий изобилие. Тот, Кто увеличивает удел и радует сердца Своей безграничной щедростью."},
        {ar: "الخافض", ru: "Аль-Хафид", tr: "Принижающий", desc: "Унижающий гордецов и тех, кто восстает против Истины. Тот, Кто лишает Своей поддержки."},
        {ar: "الرافع", ru: "Ар-Рафи", tr: "Возвышающий", desc: "Возвышающий искренне верующих. Тот, Кто дает почет и высокое положение в обоих мирах."},
        {ar: "المعز", ru: "Аль-Муизз", tr: "Дарующий силу", desc: "Тот, Кто наделяет могуществом и почетом тех, кого пожелает из Своих рабов."},
        {ar: "المذل", ru: "Аль-Музилль", tr: "Принижающий", desc: "Лишающий величия. Тот, Кто подвергает позору тех, кто идет против Его воли и законов."},
        {ar: "السميع", ru: "Ас-Сами", tr: "Всеслышащий", desc: "Тот, Кто слышит всё. Даже тайные мысли в глубине души не скрыты от Его слуха."},
        {ar: "البصير", ru: "Аль-Басир", tr: "Всевидящий", desc: "Тот, Кто видит абсолютно всё. Ни одна песчинка во Вселенной не может скрыться от Его взора."},
        {ar: "الحكم", ru: "Аль-Хакам", tr: "Судья", desc: "Тот, Чье решение окончательно и справедливо. Его законы — это истинный стандарт справедливости."},
        {ar: "العدл", ru: "Аль-Адль", tr: "Справедливый", desc: "Тот, Кто абсолютно справедлив в Своих действиях. Он никогда не поступает несправедливо даже на вес атома."},
        {ar: "اللطيف", ru: "Аль-Лятиф", tr: "Проницательный", desc: "Знающий все тайны. Тот, Кто проявляет доброту и милость к рабам так тонко, что они этого не замечают."},
        {ar: "الخبير", ru: "Аль-Хабир", tr: "Сведущий", desc: "Полностью осведомленный о внутренней сути каждой вещи. Тот, Кто знает скрытые намерения."},
        {ar: "الحليم", ru: "Аль-Халим", tr: "Сдержанный", desc: "Тот, Кто не спешит с наказанием за грехи, давая человеку время осознать и раскаяться."},
        {ar: "العظيم", ru: "Аль-Азим", tr: "Величайший", desc: "Тот, Чье величие бесконечно. Ни один разум не способен полностью осознать Его мощь и размах."},
        {ar: "الغفور", ru: "Аль-Гафур", tr: "Всепрощающий", desc: "Тот, Кто стирает любые грехи, если человек обращается к Нему с искренним раскаянием."},
        {ar: "الشكور", ru: "Аш-Шакур", tr: "Благодарный", desc: "Тот, Кто вознаграждает многократно даже за самое маленькое доброе дело Своего раба."},
        {ar: "العلي", ru: "Аль-Алий", tr: "Высочайший", desc: "Тот, Кто выше всего сущего по положению, власти и сущности. Ничто не может сравниться с Ним."},
        {ar: "الكبير", ru: "Аль-Кабир", tr: "Великий", desc: "Тот, пред Кем всё мироздание кажется ничтожным. Обладатель совершенного масштаба."},
        {ar: "الحفيظ", ru: "Аль-Хафиз", tr: "Хранитель", desc: "Тот, Кто оберегает небеса и землю от разрушения и записывает каждое деяние рабов."},
        {ar: "المقيت", ru: "Аль-Мукит", tr: "Дающий пищу", desc: "Тот, Кто наделяет силой и пропитанием. Распорядитель всех ресурсов во Вселенной."},
        {ar: "الحسيب", ru: "Аль-Хасиб", tr: "Достаточный", desc: "Тот, Кого достаточно для помощи и защиты. Он ведет идеальный расчет всех дел."},
        {ar: "الجليل", ru: "Аль-Джалиль", tr: "Величественный", desc: "Обладатель качеств совершенства. Тот, Кто вызывает трепет и высшее уважение в сердцах."},
        {ar: "الكريم", ru: "Аль-Карим", tr: "Щедрый", desc: "Тот, Кто одаряет благами без просьбы и прощает даже тех, кто совершил ошибки."},
        {ar: "الرقيب", ru: "Ар-Ракиб", tr: "Наблюдающий", desc: "Тот, от Чьего взора не ускользает ни одно движение и ни один вздох в мироздании."},
        {ar: "المجيب", ru: "Аль-Муджиб", tr: "Отзывающийся", desc: "Тот, Кто отвечает на мольбы Своих созданий. Он слышит зов каждого нуждающегося."},
        {ar: "الواسع", ru: "Аль-Васи", tr: "Всеобъемлющий", desc: "Тот, Чья милость, богатство и знание не имеют границ и охватывают всё пространство."},
        {ar: "الحكيم", ru: "Аль-Хаким", tr: "Мудрый", desc: "Тот, Чьи действия лишены ошибок. Всё, что Он создает, имеет глубочайший смысл."},
        {ar: "الودود", ru: "Аль-Вадуд", tr: "Любящий", desc: "Тот, Кто искренне любит Своих праведных рабов и наполняет сердца людей любовью."},
        {ar: "المجيد", ru: "Аль-Маджид", tr: "Славный", desc: "Тот, Кто обладает высшей честью и бесконечной славой. Источник всякого благородства."},
        {ar: "الباعث", ru: "Аль-Баис", tr: "Воскрешающий", desc: "Тот, Кто воскресит всех умерших в День Суда для окончательного отчета и вечной жизни."},
        {ar: "الشهيد", ru: "Аш-Шахид", tr: "Свидетель", desc: "Тот, Кто присутствует везде и видит каждое событие. От Него невозможно скрыть правду."},
        {ar: "الحق", ru: "Аль-Хакк", tr: "Истина", desc: "Тот, Чье существование вечно и реально. Он — истинный Бог, и Его обещания незыблемы."},
        {ar: "الوكيل", ru: "Аль-Вакиль", tr: "Попечитель", desc: "Тот, на Кого можно полностью положиться. Лучший защитник для тех, кто Ему доверяет."},
        {ar: "القوي", ru: "Аль-Кавий", tr: "Всесильный", desc: "Обладатель совершенной силы. Никакая слабость или усталость никогда не коснутся Его."},
        {ar: "المتين", ru: "Аль-Матин", tr: "Непоколебимый", desc: "Тот, Чье могущество твердо. Его воля реализуется беспрепятственно и без усилий."},
        {ar: "الولي", ru: "Аль-Валий", tr: "Покровитель", desc: "Близкий друг верующих. Тот, Кто помогает им преодолевать тьму и трудности."},
        {ar: "الحميد", ru: "Аль-Хамид", tr: "Достославный", desc: "Тот, Кто заслуживает всяческой похвалы. Все совершенства принадлежат только Ему."},
        {ar: "المحصي", ru: "Аль-Мухси", tr: "Считающий", desc: "Тот, Кто знает точное количество каждой вещи — от звезд до капель дождя."},
        {ar: "المبدئ", ru: "Аль-Мубди", tr: "Основатель", desc: "Тот, Кто начал творение в самый первый раз, не имея примера или чертежа."},
        {ar: "المعيد", ru: "Аль-Муид", tr: "Возвращающий", desc: "Тот, Кто восстановит всё живое после смерти в том же облике, в каком оно было."},
        {ar: "المحيي", ru: "Аль-Мухйи", tr: "Оживляющий", desc: "Дарующий жизнь. Тот, Кто оживляет мертвую землю и вдыхает душу в тела."},
        {ar: "المميت", ru: "Аль-Мумит", tr: "Умерщвляющий", desc: "Тот, в Чьей власти находится завершение жизни. Смерть наступает только по Его воле."},
        {ar: "الحي", ru: "Аль-Хайй", tr: "Вечно живой", desc: "Обладатель вечной жизни. Он был всегда и будет всегда, жизнь Его совершенна."},
        {ar: "القيوم", ru: "Аль-Каййум", tr: "Самодостаточный", desc: "Тот, Кто поддерживает жизнь всей Вселенной, при этом не нуждаясь ни в чьей помощи."},
        {ar: "الواجد", ru: "Аль-Ваджид", tr: "Находящий", desc: "Тот, Кто находит всё, что пожелает. У Него нет нужды в поисках — всё пред Ним."},
        {ar: "الماجد", ru: "Аль-Маджид", tr: "Благородный", desc: "Тот, Кто обладает неисчерпаемой щедростью и высшим благородством сущности."},
        {ar: "الواحد", ru: "Аль-Вахид", tr: "Единственный", desc: "Тот, Кто един в Своих делах. Нет у Него сотоварищей в управлении миром."},
        {ar: "الأحد", ru: "Аль-Ахад", tr: "Единый", desc: "Тот, Кто един в Своей сущности. Он не делим и не имеет подобия среди творений."},
        {ar: "الصمد", ru: "Ас-Самад", tr: "Вечный", desc: "Тот, к Кому все обращаются со своими нуждами. Он ни от кого не зависит, а всё зависит от Него."},
        {ar: "القادر", ru: "Аль-Кадир", tr: "Всемогущий", desc: "Тот, Кто может сотворить абсолютно всё или уничтожить по первому желанию."},
        {ar: "المقتدر", ru: "Аль-Муктадир", tr: "Всевластный", desc: "Тот, Чья мощь реализует любое предопределение мгновенно и без преград."},
        {ar: "المقدم", ru: "Аль-Мукаддим", tr: "Выдвигающий вперед", desc: "Тот, Кто возвышает людей и события по Своей мудрости, определяя им первое место."},
        {ar: "المؤخر", ru: "Аль-Муаххир", tr: "Отодвигающий", desc: "Тот, Кто отдаляет события или людей, оставляя их позади согласно Своему знанию."},
        {ar: "الأول", ru: "Аль-Авваль", tr: "Первый", desc: "Тот, Кто существовал до сотворения времени и пространства. У Него нет начала."},
        {ar: "الآخر", ru: "Аль-Ахир", tr: "Последний", desc: "Тот, Кто останется после того, как всё сущее исчезнет. У Него нет конца."},
        {ar: "الظاهر", ru: "Аз-Захир", tr: "Явный", desc: "Тот, Чье существование очевидно через Его бесконечные знамения в этом мире."},
        {ar: "الباطن", ru: "Аль-Батин", tr: "Скрытый", desc: "Тот, Кого невозможно увидеть глазами в этой жизни. Он знает самые сокровенные тайны."},
        {ar: "الوالي", ru: "Аль-Вали", tr: "Правящий", desc: "Единственный истинный Владыка. Он распоряжается делами Вселенной единолично."},
        {ar: "المتعالي", ru: "Аль-Мутаали", tr: "Высочайший", desc: "Тот, Кто бесконечно выше любых недостатков или качеств, приписываемых творениями."},
        {ar: "البر", ru: "Аль-Барр", tr: "Благостный", desc: "Тот, Кто проявляет безграничную доброту к Своим рабам и исполняет все обещания."},
        {ar: "التواب", ru: "Ат-Тавваб", tr: "Принимающий покаяние", desc: "Тот, Кто вновь и вновь принимает раскаяние рабов, облегчая им путь к Себе."},
        {ar: "المنتقم", ru: "Аль-Мунтакым", tr: "Мстящий", desc: "Тот, Кто справедливо наказывает упорствующих в зле и грехах. Его кара неизбежна."},
        {ar: "العفو", ru: "Аль-Афувв", tr: "Снисходительный", desc: "Тот, Кто полностью стирает грехи рабов, так что от них не остается и следа."},
        {ar: "الرؤوف", ru: "Ар-Рауф", tr: "Сострадательный", desc: "Тот, Чья милость проявляется в глубоком сочувствии и мягкости к Своим созданиям."},
        {ar: "مالك الملك", ru: "Маликуль-Мульк", tr: "Царь царей", desc: "Обладатель абсолютной власти над всеми владениями и правителями Вселенной."},
        {ar: "ذو الجلال والإكرام", ru: "Зуль-Джаляли валь-Икрам", tr: "Обладатель величия и щедрости", desc: "Тот, Кто заслуживает высшего почтения и Кто наделяет огромными благами."},
        {ar: "المقسط", ru: "Аль-Муксит", tr: "Беспристрастный", desc: "Тот, Кто восстанавливает справедливость, защищая слабых от угнетения."},
        {ar: "الجامع", ru: "Аль-Джами", tr: "Собирающий", desc: "Тот, Кто соберет всё человечество вместе в День Суда из разных уголков земли."},
        {ar: "الغني", ru: "Аль-Ганий", tr: "Богатый", desc: "Тот, Кто обладает абсолютным богатством. Вся Вселенная нуждается в Нем, а Он — ни в ком."},
        {ar: "المгн", ru: "Аль-Мугни", tr: "Обогащающий", desc: "Тот, Кто наделяет достатком и довольством тех, кого пожелает из Своих рабов."},
        {ar: "المانع", ru: "Аль-Мани", tr: "Удерживающий", desc: "Тот, Кто по Своей мудрости не дает случиться вреду или ограничивает блага во благо."},
        {ar: "الضار", ru: "Ад-Дарр", tr: "Лишающий", desc: "Тот, во власти Кого находится всё неприятное. Ничто не принесет вреда без Его воли."},
        {ar: "الнаф", ru: "Ан-Нафи", tr: "Благотворящий", desc: "Тот, от Кого исходит любая польза. Источник всякого счастья и успеха в жизни."},
        {ar: "النور", ru: "Ан-Нур", tr: "Свет", desc: "Тот, Кто освещает небеса и землю светом истины. Он дарует ясное видение сердцам."},
        {ar: "الهادي", ru: "Аль-Хади", tr: "Ведущий верным путем", desc: "Тот, Кто направляет Своих рабов к спасению, истинной вере и правильным решениям."},
        {ar: "البديع", ru: "Аль-Бади", tr: "Изобретающий", desc: "Тот, Кто создал Вселенную уникальной, не используя никаких предшествующих образцов."},
        {ar: "الباقي", ru: "Аль-Бакы", tr: "Вечный", desc: "Тот, Кто пребудет вечно. Всё во Вселенной может исчезнуть, но Он останется навсегда."},
        {ar: "الوارث", ru: "Аль-Варис", tr: "Наследник", desc: "Тот, к Кому вернется вся власть и всё имущество после гибели всех творений."},
        {ar: "الرشيد", ru: "Ар-Рашид", tr: "Правильный", desc: "Тот, Кто ведет все дела к совершенному результату самым коротким и верным путем."},
        {ar: "الصبور", ru: "Ас-Сабур", tr: "Терпеливый", desc: "Тот, Кто не спешит с наказанием, давая шанс каждому творению исправить свою жизнь."}
    ],
    async init() {
        try {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            this.surahs = data.data;
            this.renderSurahs(this.surahs);
            this.loadPrayers();
            this.renderAcademy();
            this.renderNames();
            this.updateBookmarkUI();
            document.getElementById('tasbih-num').innerText = this.tasbihCount;
        } catch (e) { console.error("Init Error", e); }
    },

    nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(`p-${id}`).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        const map = {home:0, quran:1, prayer:2, academy:3, tasbih:0, names:0, lessons:3};
        if(map[id] !== undefined) document.querySelectorAll('.nav-btn')[map[id]].classList.add('active');
        document.getElementById('appScroll').scrollTo(0,0);
    },

 renderSurahs(list) {
    const box = document.getElementById('surahList');
    box.innerHTML = list.map(s => `
        <div class="card-sm" onclick="App.openReader(${s.number}, '${s.englishName}')">
            <div class="quran-bg-text">القرآن</div> 
            
            <div class="icon-box">${s.number}</div>
            <div>
                <div class="card-title">${s.englishName}</div>
                <div class="card-sub">${s.numberOfAyahs} аятов</div>
            </div>
        </div>`).join('');
},


    renderAcademy() {
        const box = document.getElementById('academy-list');
        box.innerHTML = this.courses.map(c => `
            <div class="card-lg" style="margin-bottom:15px;" onclick="App.openLessons('${c.name}', '${c.url}')">
                <div style="display:flex; gap:20px; align-items:center;">
                    <div class="icon-box"><i class="fa-solid ${c.icon}"></i></div>
                    <div><div class="card-title">${c.name}</div><div class="card-sub">${c.sub} • уроки</div></div>
                </div>
            </div>`).join('');
    },

    openLessons(title, playlistUrl) {
        this.nav('lessons');
        const box = document.getElementById('lessons-view');
        let html = `<div onclick="App.nav('academy')" style="margin-bottom:20px; font-weight:800; color:var(--accent)">← Назад</div><h2>${title}</h2><br>`;
        for(let i=1; i<=1; i++) {
            html += `
                <div class="lesson-row" onclick="window.open('${playlistUrl}', '_blank')">
                    <div class="lesson-id">${i}</div>
                    <div style="flex:1">
                        <div class="card-title" style="font-size:16px;">Плейст уроков</div>
                        <div class="card-sub">Нажмите, чтобы смотреть на YouTube</div>
                    </div>
                    <i class="fa-solid fa-circle-play" style="color:var(--accent); font-size:24px;"></i>
                </div>`;
        }
        box.innerHTML = html;
    },

    countTasbih() {
        this.tasbihCount++;
        document.getElementById('tasbih-num').innerText = this.tasbihCount;
        localStorage.setItem('tasbih_val', this.tasbihCount);
        if(navigator.vibrate) navigator.vibrate(50);
    },

    resetTasbih() {
        if(confirm("Сбросить счетчик?")) {
            this.tasbihCount = 0;
            document.getElementById('tasbih-num').innerText = 0;
            localStorage.setItem('tasbih_val', 0);
        }
    },

    renderNames() {
        const box = document.getElementById('names-list');
        box.innerHTML = this.all99Names.map((n, i) => `
            <div class="card-lg" style="margin-bottom:12px; display:flex; justify-content:space-between; align-items:center;" onclick="App.openNameDetail(${i})">
                <div><div class="card-title">${i+1}. ${n.ru}</div><div class="card-sub">${n.tr}</div></div>
                <div class="ar-text" style="font-size:28px; margin-bottom:0;">${n.ar}</div>
            </div>
        `).join('');
    },

    openNameDetail(index) {
        const n = this.all99Names[index];
        const modal = document.getElementById('nameModal');
        modal.innerHTML = `
            <div onclick="document.getElementById('nameModal').classList.remove('active')" style="font-size:18px; margin-bottom:30px; color:var(--accent); font-weight:800;"><i class="fa-solid fa-arrow-left"></i> НАЗАД</div>
            <div style="text-align:center;">
                <div class="ar-text" style="font-size:80px; text-align:center; color:var(--accent); margin-bottom:10px;">${n.ar}</div>
                <h1 style="font-size:32px; margin-bottom:5px;">${n.ru}</h1>
                <p style="color:var(--accent); font-weight:700; text-transform:uppercase; margin-bottom:30px;">${n.tr}</p>
                <div class="card-lg" style="text-align:left; line-height:1.8; font-size:17px;"><b style="color:var(--accent); display:block; margin-bottom:10px;">ЗНАЧЕНИЕ:</b>${n.desc}</div>
            </div>
        `;
        modal.classList.add('active');
    },

    search(val) {
        const f = this.surahs.filter(s => s.englishName.toLowerCase().includes(val.toLowerCase()) || s.number == val);
        this.renderSurahs(f);
    },

    async openReader(num, name, scrollAyah = null) {
        this.nav('reader');
        const header = document.getElementById('readerHeader');
        const view = document.getElementById('readerView');
        header.innerHTML = `<div style="display:flex; align-items:center; gap:15px; margin-bottom:25px;"><div onclick="App.nav('quran')" style="font-size:20px;"><i class="fa-solid fa-arrow-left"></i></div><div><h2 style="font-weight:800;">${name}</h2><p style="font-size:12px; color:var(--accent)">СУРА ${num}</p></div></div>`;
        view.innerHTML = '<div class="loader">Загрузка...</div>';
        try {
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/editions/quran-uthmani,ru.kuliev,ru.muntahab`);
            const d = await res.json();
            let html = '';
            d.data[0].ayahs.forEach((a, i) => {
                const ayahKey = `${num}:${i+1}`;
                html += `<div class="ayah-card" id="ayah-pos-${i+1}"><div class="ar-text">${a.text}</div><div class="ru-text">${d.data[1].ayahs[i].text}</div><div class="tafsir-box"><b style="color:var(--accent); font-size:11px; display:block; margin-bottom:5px;">ТАФСИР МУНТАХАБ:</b>${d.data[2].ayahs[i].text}</div><div class="ayah-footer"><span>Аят: ${i+1}</span><div class="ayah-actions"><div class="action-btn" id="btn-${ayahKey}" onclick="App.playAyah('${ayahKey}', ${num}, ${i+1})"><i class="fa-solid fa-play"></i></div><div class="action-btn" onclick="App.setBookmark(${num}, '${name}', ${i+1})"><i class="fa-solid fa-bookmark"></i></div></div></div></div>`;
            });
            view.innerHTML = html;
            if(scrollAyah) { setTimeout(() => { const el = document.getElementById(`ayah-pos-${scrollAyah}`); if(el) el.scrollIntoView({ behavior: 'smooth', block: 'center'}); }, 500); }
        } catch (e) { view.innerHTML = 'Ошибка загрузки.'; }
    },

    setBookmark(sNum, sName, aNum) {
        this.bookmark = { sNum, sName, aNum };
        localStorage.setItem('ilm_last_bookmark', JSON.stringify(this.bookmark));
        this.updateBookmarkUI();
        alert("Сохранено!");
    },

    updateBookmarkUI() {
        const container = document.getElementById('last-read-container');
        if(this.bookmark) {
            container.innerHTML = `<div class="card-lg" style="border: 1px solid var(--accent); background: rgba(212,175,55,0.05);" onclick="App.openReader(${this.bookmark.sNum}, '${this.bookmark.sName}', ${this.bookmark.aNum})"><div class="card-sub" style="color:var(--accent)">ПРОДОЛЖИТЬ ЧТЕНИЕ</div><div class="card-title">${this.bookmark.sName}, аят ${this.bookmark.aNum}</div></div>`;
        }
    },

    playAyah(id, s, a) {
        const globalId = this.getGlobalAyahId(s, a);
        const url = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${globalId}.mp3`;
        if (this.currentPlayingId === id && !this.audio.paused) {
            this.audio.pause();
            document.getElementById(`btn-${id}`).innerHTML = '<i class="fa-solid fa-play"></i>';
        } else {
            if (this.currentPlayingId) { 
                const oldBtn = document.getElementById(`btn-${this.currentPlayingId}`);
                if(oldBtn) oldBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
            }
            this.audio.src = url;
            this.audio.play();
            this.currentPlayingId = id;
            document.getElementById(`btn-${id}`).innerHTML = '<i class="fa-solid fa-pause"></i>';
        }
    },

    getGlobalAyahId(surah, ayah) {
        const offsets = {1:0, 2:7, 3:293, 4:493, 5:669, 6:789, 7:954, 8:1160, 9:1235, 10:1364, 11:1473, 12:1596, 13:1707, 14:1750, 15:1802, 16:1901, 17:2029, 18:2140, 19:2250, 20:2348}; 
        return (offsets[surah] || 0) + ayah;
    },

    loadPrayers() {
        navigator.geolocation.getCurrentPosition(async (pos) => {
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=2`);
                const d = await res.json();
                const t = d.data.timings;
                const names = {Fajr:'Фаджр', Sunrise:'Восход', Dhuhr:'Зухр', Asr:'Аср', Maghrib:'Магриб', Isha:'Иша'};
                let html = '<div class="prayer-list">';
                for(let key in names) html += `<div class="prayer-item"><span>${names[key]}</span><span>${t[key]}</span></div>`;
                html += '</div>';
                document.getElementById('prayer-display').innerHTML = html;
            } catch(e) {}
        });
    }
};

window.onload = () => App.init();
</script>
</body>
</html>
